@using RazorLight
@using Generator.Template;
@inherits TemplatePage<ViewInfoWapper>
@{
    DisableEncoding = true;
}


@if (Model.TableInfo.PrimaryKey.Count == 0) { goto cc; }
 	        /// <summary>
            /// 添加新@(Model.TableInfo.Name)记录
            /// </summary>
            /// <param name="model">@(Model.TableInfo.Name)实体对象</param>
            /// <returns>新插入数据的id</returns>
            public static @(Model.TableInfo.PrimaryKey[0].DbType) Insert(@(Model.TableInfo.Name) model, IDbTransaction transaction = null)
            {
                var sql = new StringBuilder();
                sql.Append("INSERT INTO @Model.MakeTableName(Model.TableInfo.Name) (@Model.MakeSQLColumnList(Model.TableInfo.Columns)");
                sql.Append(" OUTPUT INSERTED.[@(Model.TableInfo.PrimaryKey[0].Name)] ");
                sql.Append("VALUES(@(Model.MakeSQLParamList(Model.TableInfo.Columns)))");
                var ret = 0;
                using (var conn = GetOpenConnection())
                    ret = conn.ExecuteScalar<@(Model.TableInfo.PrimaryKey[0].DbType)>(sql.ToString(), model, transaction);

                return ret;
            }
        
            @{ cc: }
            /// <summary>
            /// 添加新@(Model.TableInfo.Name)记录
            /// </summary>
            /// <param name="model">@(Model.TableInfo.Name)实体对象</param>
            /// <returns>是否插入成功，true为成功</returns>
            public static bool Insert(@(Model.TableInfo.Name) model, IDbTransaction transaction = null)
            {
                var sql = new StringBuilder();
                sql.Append("INSERT INTO @Model.MakeTableName(Model.TableInfo.Name) (@Model.MakeSQLColumnList(Model.TableInfo.Columns)");
                sql.Append("VALUES(@(Model.MakeSQLParamList(Model.TableInfo.Columns)))");
                var ret = false;
                using (var conn = GetOpenConnection())
                    ret = conn.Execute(sql.ToString(), model, transaction) > 0;

                return ret;
            }

            /// <summary>
            /// 批量插入@(Model.TableInfo.Name)记录
            /// </summary>
            /// <param name="model">List<@(Model.TableInfo.Name)>实体对象</param>
            /// <returns>是否插入成功，true为成功</returns>
            public static bool InsertMany(List<@(Model.TableInfo.Name)> model, IDbTransaction transaction = null)
            {
                var sql = new StringBuilder();
                sql.Append("INSERT INTO @Model.MakeTableName(Model.TableInfo.Name) (@Model.MakeSQLColumnList(Model.TableInfo.Columns)");
                sql.Append("VALUES(@(Model.MakeSQLParamList(Model.TableInfo.Columns)))");
                var ret = false;
                using (var conn = GetOpenConnection())
                    ret = conn.Execute(sql.ToString(), model, transaction) > 0;

                return ret;
            }